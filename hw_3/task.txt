Подготовка программного обеспечения и базы данных.

Установить систему управления базами данных PostgreSQL версии 15 или выше.
Установить DBeaver Community Edition.
Настроить соединение с установленным сервером PostgreSQL через DBeaver.
Восстановить базу данных dvd_rental из предоставленного файла резервной копии формата .backup.
Открыть ER-диаграмму базы данных dvd_rental в DBeaver и сделать скриншот.

SQL и получение данных

Работать с базой данных dvd_rental.

1. Вывести список всех клиентов (таблица customer).
2. Вывести имена и фамилии клиентов с именем Carolyn.
3. Вывести полные имена клиентов (имя + фамилия в одной колонке), у которых имя или фамилия содержат подстроку ary (например: Mary, Geary).
4. Вывести 20 самых крупных транзакций (таблица payment).
5. Вывести адреса всех магазинов, используя подзапрос.
6. Для каждой оплаты вывести число, месяц и день недели в числовом формате (Понедельник – 1, Вторник – 2 и т.д.).
7. Вывести, кто (customer_id), когда (rental_date, приведенная к типу date) и у кого (staff_id) брал диски в аренду в июне 2005 года.
8. Вывести название, описание и длительность фильмов (таблица film), выпущенных после 2000 года, с длительностью от 60 до 120 минут включительно. Показать первые 20 фильмов с наибольшей длительностью.
9. Найти все платежи (таблица payment), совершенные в апреле 2007 года, стоимость которых не превышает 4 долларов. Вывести идентификатор платежа, дату (без времени) и сумму платежа. Отсортировать платежи по убыванию суммы, а при равной сумме — по более ранней дате.
10. Показать имена, фамилии и идентификаторы всех клиентов с именами Jack, Bob или Sara, чья фамилия содержит букву «p». Переименовать колонки: с именем — в «Имя», с идентификатором — в «Идентификатор», с фамилией — в «Фамилия». Отсортировать клиентов по возрастанию идентификатора.
11. Работа с собственной таблицей студентов
Создать таблицу студентов с полями: имя, фамилия, возраст, дата рождения и адрес. Все поля должны запрещать внесение пустых значений (NOT NULL).
Внести в таблицу одного студента с id > 50.
Просмотреть текущие записи таблицы.
Внести несколько записей одним запросом, используя автоинкремент id.
Снова просмотреть текущие записи таблицы.
Удалить одного выбранного студента.
Вывести полный список студентов.
Удалить таблицу студентов.
Выполнить запрос на выборку из таблицы студентов и вывести его результат (показать, что таблица удалена).

JOIN и агрегатные функции

12. Вывести количество уникальных имен клиентов.
13. Вывести 5 самых часто встречающихся сумм оплаты: саму сумму, даты таких оплат, количество платежей с этой суммой и общую сумму этих платежей.
14. Вывести количество ячеек (записей) в инвентаре для каждого магазина.
15. Вывести адреса всех магазинов, используя соединение таблиц (JOIN).
16. Вывести полные имена всех клиентов и всех сотрудников в одну колонку (объединенный список).
17. Вывести имена клиентов, которые не совпадают ни с одним именем сотрудников (операция EXCEPT или аналог).
18. Вывести, кто (customer_id), когда (rental_date, приведенная к типу date) и у кого (staff_id) брал диски в аренду в июне 2005 года.
19. Вывести идентификаторы всех клиентов, у которых 40 и более оплат. Для каждого такого клиента посчитать средний размер транзакции, округлить его до двух знаков после запятой и вывести в отдельном столбце.
20. Вывести идентификатор актера, его полное имя и количество фильмов, в которых он снялся. Определить актера, снявшегося в наибольшем количестве фильмов (группировать по id актера).
21. Посчитать выручку по каждому месяцу работы проката. Месяц должен определяться по дате аренды (rental_date), а не по дате оплаты (payment_date). Округлить выручку до одного знака после запятой. Отсортировать строки в хронологическом порядке. В отчете должен присутствовать месяц, в который не было выручки (нет данных о платежах).
22. Найти средний платеж по каждому жанру фильма. Отобразить только те жанры, к которым относится более 60 различных фильмов. Округлить средний платеж до двух знаков после запятой и дать понятные названия столбцам. Отсортировать жанры по убыванию среднего платежа.
23. Определить, какие фильмы чаще всего берут напрокат по субботам. Вывести названия первых 5 самых популярных фильмов. При одинаковой популярности отдать предпочтение фильму, который идет раньше по алфавиту.


Оконные функции и простые запросы

24. Для каждой оплаты вывести сумму, дату и день недели (название дня недели текстом).

25. 
Для каждой оплаты вывести:
сумму платежа;
дату платежа;
день недели, соответствующий дате платежа, в текстовом виде (например: «понедельник», «вторник» и т.п.).
Распределить фильмы по трем категориям в зависимости от длительности:
«Короткие» — менее 70 минут;
«Средние» — от 70 минут (включительно) до 130 минут (не включая 130);
«Длинные» — от 130 минут и более.
Для каждой категории необходимо:
посчитать количество прокатов (то есть сколько раз фильмы этой категории брались в аренду);
посчитать количество фильмов, которые относятся к этой категории и хотя бы один раз сдавались в прокат.
Фильмы, у которых не было ни одного проката, не должны учитываться в подсчете количества фильмов в категории. Продумать, какой тип соединения таблиц нужно использовать, чтобы этого добиться.  
Для дальнейших заданий считать, что создана таблица weekly_revenue, в которой для каждой недели и года хранится суммарная выручка компании за эту неделю (на основании данных о прокатах и платежах).
26. На основе таблицы weekly_revenue рассчитать накопленную (кумулятивную) сумму недельной выручки бизнеса. Вывести все столбцы таблицы weekly_revenue и добавить к ним столбец с накопленной выручкой. Накопленную выручку округлить до целого числа.
27. На основе таблицы weekly_revenue рассчитать скользящую среднюю недельной выручки, используя для расчета три недели: предыдущую, текущую и следующую. Вывести всю таблицу weekly_revenue и добавить:  
столбец с накопленной суммой выручки;
столбец со скользящей средней недельной выручки.
Скользящую среднюю округлить до целого числа.

28. Рассчитать прирост недельной выручки бизнеса в процентах по сравнению с предыдущей неделей.
Прирост в процентах определяется как:  
(текущая недельная выручка – выручка предыдущей недели) / выручка предыдущей недели × 100%.
Вывести всю таблицу weekly_revenue и добавить:
​​​​​​​столбец с накопленной суммой выручки;
столбец со скользящей средней;
столбец с приростом недельной выручки в процентах.
Значение прироста в процентах округлить до двух знаков после запятой.

​​​​​​​Требования к заданию:

Необходимо установить программу DBeaver и загрузить в неё базу данных.
На основе загруженной базы данных нужно построить ER-диаграмму.
В качестве результата требуется предоставить скриншот установленной программы DBeaver с отображённой ER-диаграммой загруженной базы данных.
Скриншот должен быть сохранён в одном из следующих форматов: PDF, PNG или JPG.
Если файлов несколько, они должны быть объединены в архив формата .zip. Использование архивов формата .rar или .7z не допускается.